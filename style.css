*{box-sizing:border-box}
:root{
  --bg:#0b0d12;
  --card:#12151c;
  --text:#e8ecf8;
  --muted:#9aa3b2;
  --accent:#7a8cff;
  --accent2:#9a6bff;
  --border:#1e2330;
  --radius:14px;
  --success:#4caf50;
  --warning:#ff9800;
  --danger:#ff5a6b
}
:root.light{
  --bg:#f7f9ff;
  --card:#ffffff;
  --text:#0d1730;
  --muted:#5b6a84;
  --accent:#4e6cff;
  --accent2:#7b4bff;
  --border:#dfe5f3;
  --success:#45a049;
  --warning:#e68900;
  --danger:#e53935
}

html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(1200px 700px at 20% -10%, rgba(122,140,255,.24), transparent 60%),
    radial-gradient(900px 600px at 120% 20%, rgba(154,107,255,.18), transparent 50%),
    var(--bg);
  color:var(--text);
  font:16px/1.5 system-ui,Segoe UI,Roboto,Inter,sans-serif;
  overflow-x:hidden
}

/* Top Bar */
.topbar{
  position:sticky;
  top:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px 16px;
  background:color-mix(in oklab, var(--bg) 90%, #0000);
  backdrop-filter:saturate(1.2) blur(8px);
  border-bottom:1px solid var(--border);
  z-index:100
}

.brand{font-weight:800; white-space:nowrap}

.header-stats{
  display:flex;
  gap:16px;
  align-items:center;
  font-size:14px
}

/* Tabs */
.tabs{
  display:flex;
  overflow:auto;
  gap:8px;
  padding:8px 12px;
  border-bottom:1px solid var(--border);
  scrollbar-width:none;
  -ms-overflow-style:none
}
.tabs::-webkit-scrollbar{display:none}

.tab{
  background:transparent;
  border:1px solid var(--border);
  color:var(--muted);
  padding:8px 12px;
  border-radius:999px;
  cursor:pointer;
  transition:.2s;
  white-space:nowrap;
  font-size:14px
}
.tab:hover{
  border-color:color-mix(in oklab, var(--accent) 60%, #0000)
}
.tab.active{
  color:#fff;
  border-color:var(--accent);
  box-shadow:0 0 0 1px color-mix(in oklab, var(--accent) 40%, #0000)
}
.light .tab.active{color:var(--text)}

/* Main Content */
main{
  padding:16px;
  max-width:1060px;
  margin:0 auto;
  min-height:calc(100vh - 120px)
}

.grid{
  display:grid;
  grid-template-columns:1fr;
  gap:16px
}
@media(min-width:820px){
  .grid{grid-template-columns:1fr 1fr}
}

/* Cards */
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:0 10px 30px rgba(0,0,0,.08)
}

.title{
  font-weight:800;
  margin-bottom:8px;
  font-size:18px
}

/* Forms & Buttons */
.row{
  display:flex;
  align-items:center;
  gap:8px;
  flex-wrap:wrap
}

.input{
  flex:1;
  min-width:0;
  background:color-mix(in oklab, var(--card) 95%, #0000);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 12px;
  border-radius:12px;
  font-size:14px
}
.input:focus{
  outline:none;
  border-color:var(--accent);
  box-shadow:0 0 0 2px color-mix(in oklab, var(--accent) 30%, #0000)
}

.btn{
  border:none;
  border-radius:12px;
  padding:10px 14px;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  color:white;
  font-weight:800;
  cursor:pointer;
  transition:transform .08s, opacity .2s;
  font-size:14px
}
.btn:hover{opacity:.9}
.btn:active{transform:translateY(1px)}
.btn:disabled{
  opacity:.6;
  cursor:not-allowed
}

.btn.ghost{
  background:transparent;
  border:1px solid var(--border);
  color:var(--text)
}

.tiny{
  border:1px solid var(--border);
  background:transparent;
  border-radius:10px;
  color:var(--text);
  padding:6px 8px;
  cursor:pointer;
  font-size:12px;
  transition:all .2s
}
.tiny:hover{
  border-color:var(--accent)
}

/* Text Utilities */
.muted{color:var(--muted)}
.small{font-size:12px}
.strong{font-weight:800}

/* Progress Bars */
.bar{margin-top:8px}

.progress{
  height:10px;
  background:color-mix(in oklab, var(--card) 92%, #0000);
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden
}

.progress-fill{
  height:100%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  width:0%;
  transition:width 0.5s cubic-bezier(0.4, 0, 0.2, 1)
}

/* Health Bar */
.hpbar{
  height:12px;
  background:#220e12;
  border:1px solid #4a2330;
  border-radius:999px;
  margin-top:8px;
  overflow:hidden
}
.light .hpbar{
  background:#ffe9ec;
  border-color:#ffc5cf
}

.hpbar-fill{
  height:100%;
  background:#ff5a6b;
  width:0%;
  transition:width 0.5s cubic-bezier(0.4, 0, 0.2, 1)
}

/* Stats Grid */
.stats{
  display:grid;
  grid-template-columns:repeat(6,1fr);
  gap:8px;
  margin-top:8px
}

.stat{
  display:flex;
  flex-direction:column;
  gap:2px;
  background:color-mix(in oklab, var(--card) 92%, #0000);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  align-items:center;
  text-align:center
}

/* Lists */
.list{
  display:grid;
  gap:8px
}

.list .item{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:color-mix(in oklab, var(--card) 92%, #0000);
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px 12px;
  transition:all .2s
}
.list .item:hover{
  border-color:color-mix(in oklab, var(--accent) 40%, #0000)
}

/* Panels */
.panel{display:none}
.panel.active{display:block}

/* Toast */
#toast{
  position:fixed;
  left:50%;
  bottom:24px;
  transform:translateX(-50%);
  background:color-mix(in oklab, var(--card) 92%, #0000);
  border:1px solid var(--border);
  color:var(--text);
  padding:10px 14px;
  border-radius:10px;
  opacity:0;
  pointer-events:none;
  transition:opacity .25s, transform .25s;
  z-index:1000;
  max-width:90vw;
  text-align:center
}
#toast.show{
  opacity:1;
  transform:translateX(-50%) translateY(-6px)
}

/* Canvas */
canvas{
  background:color-mix(in oklab, var(--card) 92%, #0000);
  border:1px solid var(--border);
  border-radius:12px;
  width:100%;
  max-width:680px;
  display:block;
  margin:0 auto
}

/* Overlay */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  display:grid;
  place-items:center;
  z-index:2000;
  padding:16px
}
.overlay[hidden]{display:none !important}

.overlay-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  max-width:560px;
  width:92vw;
  padding:16px;
  max-height:90vh;
  overflow-y:auto
}

/* Badges & Misc */
.badge{
  display:inline-block;
  padding:2px 6px;
  border-radius:8px;
  border:1px solid var(--border);
  font-size:12px;
  color:#9aa3b2
}

.power{
  height:8px;
  background:color-mix(in oklab, var(--card) 88%, #0000);
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
  margin-top:6px
}

.power .fill{
  height:100%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  width:0%;
  transition:width 0.3s ease
}

/* Raid Progress */
#raidProgressWrap{
  height:6px;
  border:1px solid var(--border);
  border-radius:999px;
  overflow:hidden;
  margin:8px 0;
  background:color-mix(in oklab, var(--card) 92%, #0000)
}

#raidProgress{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,var(--accent),var(--accent2));
  transition:width 0.5s cubic-bezier(0.4, 0, 0.2, 1)
}

/* NEW: Stat Allocation System */
.stat-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none;
  color: white;
  padding: 6px 12px;
  border-radius: 6px;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  min-width: 60px;
}

.stat-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(122, 140, 255, 0.3);
}

.stat-btn:active {
  transform: translateY(0);
}

.stat-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
}

/* NEW: Equipment Status */
.equipment-status {
  font-size: 11px;
  color: var(--muted);
  margin-top: 8px;
  text-align: center;
  line-height: 1.3;
  max-width: 140px;
}

/* NEW: Avatar Container */
.avatar-wrap {
  position: relative;
  display: inline-block;
  text-align: center;
}

/* NEW: Current Equipment Display */
#currentEquipment .item {
  padding: 8px 12px;
  border-radius: 6px;
  background: color-mix(in oklab, var(--card) 92%, #0000);
  margin-bottom: 4px;
  border: 1px solid var(--border);
}

#currentEquipment .item:last-child {
  margin-bottom: 0;
}

/* NEW: Loading States */
.loading {
  opacity: 0.7;
  pointer-events: none;
}

/* NEW: Responsive Improvements */
@media (max-width: 480px) {
  .header-stats {
    gap: 12px;
    font-size: 12px;
  }
  
  .tabs {
    padding: 6px 8px;
  }
  
  .tab {
    padding: 6px 10px;
    font-size: 12px;
  }
  
  main {
    padding: 12px;
  }
  
  .stats {
    grid-template-columns: repeat(3, 1fr);
    gap: 6px;
  }
  
  .stat {
    padding: 8px 10px;
    font-size: 14px;
  }
}

/* NEW: Focus styles for accessibility */
button:focus-visible,
input:focus-visible {
  outline: 2px solid var(--accent);
  outline-offset: 2px;
}

/* NEW: Smooth scrolling */
html {
  scroll-behavior: smooth;
}
/* ADD THESE TO YOUR EXISTING CSS */

/* Enhanced Non-Negotiable Logging Buttons */
.tiny[data-log] {
  padding: 6px 10px;
  font-size: 11px;
  background: color-mix(in oklab, var(--accent) 12%, transparent);
  border: 1px solid color-mix(in oklab, var(--accent) 30%, transparent);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-weight: 600;
}

.tiny[data-log]:hover:not(:disabled) {
  background: color-mix(in oklab, var(--accent) 20%, transparent);
  border-color: var(--accent);
  transform: translateY(-1px);
}

.tiny[data-log]:active {
  transform: translateY(0);
}

/* Underling Status Indicators */
.underling-status {
  display: flex;
  align-items: center;
  gap: 8px;
  margin: 8px 0;
  padding: 8px;
  background: color-mix(in oklab, var(--card) 92%, transparent);
  border-radius: 8px;
  border: 1px solid var(--border);
}

.underling-dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--muted);
  transition: all 0.3s ease;
}

.underling-dot.defeated {
  background: var(--success);
  transform: scale(1.2);
}

.underling-dot.current {
  background: var(--accent);
  box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 30%, transparent);
  animation: pulse 1.5s infinite;
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.6; }
}

/* Boss Empowered Warning */
.boss-empowered {
  color: var(--warning);
  font-weight: bold;
  animation: glow 2s infinite;
}

@keyframes glow {
  0%, 100% { text-shadow: 0 0 5px color-mix(in oklab, var(--warning) 50%, transparent); }
  50% { text-shadow: 0 0 10px var(--warning), 0 0 20px color-mix(in oklab, var(--warning) 30%, transparent); }
}

/* Enhanced Quest Completion States */
.item.completed {
  border-color: color-mix(in oklab, var(--success) 40%, transparent);
  background: color-mix(in oklab, var(--success) 8%, transparent);
}

.item.completed .progress-fill {
  background: linear-gradient(90deg, var(--success), color-mix(in oklab, var(--success) 70%, var(--accent)));
}

/* Better Equipment Rarity Colors */
.rarity-common { color: var(--muted); }
.rarity-uncommon { color: #2ecc71; }
.rarity-rare { color: #3498db; }
.rarity-epic { color: #9b59b6; }
.rarity-legendary { color: #f1c40f; }

/* Avatar Enhancements */
.avatar-container {
  position: relative;
  display: inline-block;
  text-align: center;
}

.equipment-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
}

/* Compact Stat Allocation */
.stat-points-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 6px;
  margin-top: 8px;
}

.stat-btn {
  background: linear-gradient(135deg, var(--accent), var(--accent2));
  border: none;
  color: white;
  padding: 6px 8px;
  border-radius: 6px;
  font-size: 11px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 0;
}

.stat-btn:hover:not(:disabled) {
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(122, 140, 255, 0.3);
}

.stat-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none;
  box-shadow: none;
}

/* Mobile Optimization for New Features */
@media (max-width: 480px) {
  .tiny[data-log] {
    padding: 5px 8px;
    font-size: 10px;
    flex: 1;
    min-width: 0;
    text-align: center;
  }
  
  .stat-points-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 4px;
  }
  
  .stat-btn {
    padding: 5px 6px;
    font-size: 10px;
  }
}

/* Enhanced Dungeon List Items */
.dungeon-with-underlings::after {
  content: " • 2 underlings";
  font-size: 11px;
  color: var(--muted);
  margin-left: 4px;
}

/* Smooth transitions for new UI elements */
.card, .item, button, .progress-fill {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}
